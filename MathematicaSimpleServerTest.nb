(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     14218,        374]
NotebookOptionsPosition[     13036,        333]
NotebookOutlinePosition[     13383,        348]
CellTagsIndexPosition[     13340,        345]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["\:0417\:0430\:0433\:0440\:0443\:0437\:043a\:0430 \:043a\:043e\:043d\
\:0442\:0435\:043a\:0441\:0442\:043e\:0432", "Text",
 CellChangeTimes->{{3.694275152990738*^9, 3.6942751607369947`*^9}}],

Cell[BoxData[
 RowBox[{"<<", "MathematicaSimpleServer`"}]], "Code",
 CellChangeTimes->{{3.6941046910034914`*^9, 3.694104702950652*^9}}],

Cell["\:0421\:043e\:0437\:0434\:0430\:043d\:0438\:0435 \:0444\:0443\:043d\
\:043a\:0446\:0438\:0438 \:0434\:043b\:044f \:043f\:0440\:043e\:0432\:0435\
\:0440\:043a\:0438 \:0430\:0434\:0440\:0435\:0441\:0430 \:0432 \:0437\:0430\
\:043f\:0440\:043e\:0441\:0435", "Text",
 CellChangeTimes->{{3.6942751640331974`*^9, 3.6942751765903487`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "\:043f\:0440\:043e\:0432\:0435\:0440\:043a\:0430", " ", 
     "\:0447\:0442\:043e", " ", "\:0430\:0434\:0440\:0435\:0441"}], " ", "-", 
    " ", 
    RowBox[{
    "\:0433\:043b\:0430\:0432\:043d\:0430\:044f", " ", 
     "\:0441\:0442\:0440\:0430\:043d\:0438\:0446\:0430"}]}], " ", "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"RequestToIndexPageQ", "[", "request_String", "]"}], " ", ":=", 
     " ", "\n", 
     RowBox[{"StringContainsQ", "[", 
      RowBox[{
       RowBox[{"First", "[", 
        RowBox[{"StringSplit", "[", 
         RowBox[{"request", ",", " ", "\"\<\\r\\n\>\""}], "]"}], "]"}], ",", 
       " ", 
       RowBox[{"\"\< / \>\"", " ", "|", " ", "\"\< /index \>\""}]}], "]"}]}], 
    ";"}], "\n", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "\:043f\:0440\:043e\:0432\:0435\:0440\:043a\:0430", " ", 
      "\:0447\:0442\:043e", " ", "\:0430\:0434\:0440\:0435\:0441"}], " ", "-",
      " ", 
     RowBox[{
     "\:0434\:0440\:0443\:0433\:0438\:0435", " ", 
      "\:0441\:0442\:0440\:0430\:043d\:0438\:0446\:044b"}]}], " ", "*)"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RequestToOtherPageQ", "[", "request_String", "]"}], " ", ":=", 
     " ", "\n", 
     RowBox[{"StringMatchQ", "[", "\n", "\t", 
      RowBox[{"request", ",", " ", "\n", "\t", 
       RowBox[{
       "\"\<GET /\>\"", " ", "~~", " ", "__", " ", "~~", " ", 
        "\"\< HTTP/1.1\\r\\n\>\"", " ", "~~", " ", "___"}]}], "\n", "]"}]}], 
    ";"}]}]}]], "Code",
 CellChangeTimes->{{3.694274689993535*^9, 3.6942748004116583`*^9}, {
   3.6942748889946823`*^9, 3.6942749502181525`*^9}, {3.6942751451343985`*^9, 
   3.6942751475494633`*^9}, {3.694275178920993*^9, 3.6942752103163624`*^9}, 
   3.6942765647787895`*^9, {3.694276602248515*^9, 3.69427665632334*^9}}],

Cell["\:0424\:0443\:043d\:043a\:0446\:0438\:044f \:043f\:043e\:043b\:0443\
\:0447\:0435\:043d\:0438\:044f \:0430\:0434\:0440\:0435\:0441\:0430 \:0438\
\:0437 \:0441\:0442\:0440\:043e\:043a\:0438 \:0437\:0430\:043f\:0440\:043e\
\:0441\:0430", "Text",
 CellChangeTimes->{{3.694275238247738*^9, 3.6942752462895*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RequestTakeAddress", "[", "request_String", "]"}], " ", ":=", 
    " ", "\n", 
    RowBox[{"First", "[", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"StringCases", "[", "\n", "\t", 
        RowBox[{
         RowBox[{"First", "[", 
          RowBox[{"StringSplit", "[", 
           RowBox[{"request", ",", " ", "\"\<\\r\\n\>\""}], "]"}], "]"}], ",",
          " ", "\n", "\t", 
         RowBox[{
          RowBox[{
          "\"\<GET \>\"", " ", "~~", " ", "address__", " ", "~~", " ", 
           "\"\< HTTP/1.1\>\""}], " ", ":>", " ", "address"}]}], "\n", "]"}], 
       "}"}], "]"}], "]"}]}], ";"}], " "}]], "Code",
 CellChangeTimes->{{3.6942748582250586`*^9, 3.694274886147812*^9}, {
  3.694274986438755*^9, 3.6942749920866613`*^9}, {3.6942750402538605`*^9, 
  3.694275135273817*^9}, {3.6942752335881863`*^9, 3.6942752356674805`*^9}, {
  3.6942767243403673`*^9, 3.6942767334537916`*^9}, {3.6942767690989485`*^9, 
  3.6942767697292485`*^9}, {3.694276819841594*^9, 3.694276826827142*^9}, {
  3.6942770161554904`*^9, 3.694277023129719*^9}, {3.694277357068739*^9, 
  3.6942773629753523`*^9}}],

Cell["\:0424\:0443\:043d\:043a\:0446\:0438\:0438 \:0432\:043e\:0437\:0432\
\:0440\:0430\:0449\:0430\:044e\:0449\:0438\:0435 \:0433\:043b\:0430\:0432\
\:043d\:0443\:044e \:0441\:0442\:0440\:0430\:043d\:0438\:0446\:044b \:0438\
\:043b\:0438 \:0434\:0440\:0443\:0433\:0438\:0435", "Text",
 CellChangeTimes->{{3.6942752554045563`*^9, 3.694275305986943*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ServerBeanIndexPage", "[", 
     RowBox[{"\"\</\>\"", " ", "|", " ", "\"\</index\>\""}], "]"}], " ", ":=",
     " ", "\n", 
    "\"\<\n<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title>index page</title>\n\
\t</head>\n\t<body>\n\t\t<h1>Hello, World!</h1>\n\t</body>\n</html>\n\>\""}], 
   ";"}], " ", "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ServerBeanOtherPage", "[", "_String", "]"}], " ", ":=", " ", 
    "\n", 
    RowBox[{
     RowBox[{
     "StringTemplate", "[", 
      "\"\<\n<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title>other page</title>\
\n\t\t<p>`now`</p>\n\t</head>\n\t<body>\n\t\t<h2>other pages</h2>\n\t</body>\n\
</html>\n\>\"", "]"}], "[", 
     RowBox[{"<|", 
      RowBox[{"\"\<now\>\"", " ", "->", " ", 
       RowBox[{"DateString", "[", "]"}]}], "|>"}], "]"}]}], ";"}], 
  " "}]}], "Code",
 CellChangeTimes->{{3.694275311675982*^9, 3.694275562572397*^9}, {
  3.694275737109505*^9, 3.6942757400637*^9}, {3.694277169578745*^9, 
  3.6942772133607635`*^9}}],

Cell["\:0424\:0443\:043d\:043a\:0446\:0438\:0438, \:043a\:043e\:0442\:043e\
\:0440\:044b\:0435 \:0432\:043e\:0437\:0432\:0440\:0430\:0449\:0430\:044e\
\:0442 \:0441\:0430\:043c \:043e\:0442\:0432\:0435\:0442", "Text",
 CellChangeTimes->{{3.694275577979503*^9, 3.6942755868169346`*^9}, {
  3.694275741530869*^9, 3.6942757424788833`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ResponseCreate", "[", "content_String", "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{
   RowBox[{"StringTemplate", "[", 
    RowBox[{
    "\"\<HTTP 200 OK\\r\\n\>\"", " ", "<>", " ", "\n", 
     "\"\<Content-length: `length`\\r\\n\>\"", " ", "<>", " ", "\n", 
     "\"\<Connection: close\\r\\n\\r\\n\>\"", " ", "<>", " ", "\n", 
     "content"}], "]"}], "[", 
   RowBox[{"<|", 
    RowBox[{"\"\<length\>\"", " ", "->", " ", 
     RowBox[{"StringLength", "[", "content", "]"}]}], "|>"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.6942755935660954`*^9, 3.6942757248949437`*^9}}],

Cell["\:0421\:043e\:0437\:0434\:0430\:043d\:0438\:0435 \:043a\:043e\:043c\
\:043f\:043e\:043d\:0435\:043d\:0442 \:043e\:0431\:0440\:0430\:0431\:043e\
\:0442\:0447\:0438\:043a\:0430", "Text",
 CellChangeTimes->{{3.6942757500802326`*^9, 3.69427575970379*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"parser", " ", "=", " ", "\n", 
   RowBox[{"RequestParser", "[", "\n", "\t", 
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{
      RowBox[{"\"\<index\>\"", " ", "->", " ", 
       RowBox[{
       "RequestToIndexPageQ", " ", "->", " ", "RequestTakeAddress"}]}], ",", 
      " ", "\n", "\t\t", 
      RowBox[{"\"\<other\>\"", " ", "->", " ", 
       RowBox[{
       "RequestToOtherPageQ", " ", "->", " ", "RequestTakeAddress"}]}]}], 
     "\n", "\t", "}"}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"bean", " ", "=", " ", "\n", 
   RowBox[{"ServerBean", "[", "\n", "\t", 
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{
      RowBox[{"\"\<index\>\"", " ", "->", " ", "ServerBeanIndexPage"}], ",", 
      " ", "\n", "\t\t", 
      RowBox[{"\"\<other\>\"", " ", "->", " ", "ServerBeanOtherPage"}]}], 
     "\n", "\t", "}"}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{"generator", " ", "=", " ", "\n", 
  RowBox[{"ResponseGenerator", "[", "\n", "\t", 
   RowBox[{"{", "\n", "\t\t", 
    RowBox[{
     RowBox[{"\"\<index\>\"", " ", "->", " ", "ResponseCreate"}], ",", " ", 
     "\n", "\t\t", 
     RowBox[{"\"\<other\>\"", " ", "->", " ", "ResponseCreate"}]}], "\n", 
    "\t", "}"}], "\n", "]"}]}]}], "Code",
 CellChangeTimes->{{3.6942757627877846`*^9, 3.6942759670489407`*^9}}],

Cell[BoxData[
 RowBox[{"RequestParser", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\<\"index\"\>", "\[Rule]", 
     RowBox[{"RequestToIndexPageQ", "\[Rule]", "RequestTakeAddress"}]}], ",", 
    RowBox[{"\<\"other\"\>", "\[Rule]", 
     RowBox[{"RequestToOtherPageQ", "\[Rule]", "RequestTakeAddress"}]}]}], 
   "}"}], "]"}]], "Output",
 CellChangeTimes->{3.694275967949811*^9, 3.69427622457075*^9, 
  3.6942764515939693`*^9, 3.694276671797742*^9, 3.694276751458321*^9, 
  3.694277073618842*^9, 3.6942771443505096`*^9}],

Cell[BoxData[
 RowBox[{"ServerBean", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\<\"index\"\>", "\[Rule]", "ServerBeanIndexPage"}], ",", 
    RowBox[{"\<\"other\"\>", "\[Rule]", "ServerBeanOtherPage"}]}], "}"}], 
  "]"}]], "Output",
 CellChangeTimes->{3.694275967949811*^9, 3.69427622457075*^9, 
  3.6942764515939693`*^9, 3.694276671797742*^9, 3.694276751458321*^9, 
  3.694277073618842*^9, 3.694277144351511*^9}],

Cell[BoxData[
 RowBox[{"ResponseGenerator", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\<\"index\"\>", "\[Rule]", "ResponseCreate"}], ",", 
    RowBox[{"\<\"other\"\>", "\[Rule]", "ResponseCreate"}]}], "}"}], 
  "]"}]], "Output",
 CellChangeTimes->{3.694275967949811*^9, 3.69427622457075*^9, 
  3.6942764515939693`*^9, 3.694276671797742*^9, 3.694276751458321*^9, 
  3.694277073618842*^9, 3.694277144353512*^9}]
}, Open  ]],

Cell["\:0421\:043e\:0437\:0434\:0430\:043d\:0438\:0435 \:0441\:0430\:043c\
\:043e\:0433\:043e \:043e\:0431\:0440\:0430\:0431\:043e\:0442\:0447\:0438\
\:043a\:0430", "Text",
 CellChangeTimes->{{3.6942759745869284`*^9, 3.694275978897691*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"handler", " ", "=", " ", 
  RowBox[{"ConnectionHandlerCreate", "[", 
   RowBox[{"parser", ",", " ", "bean", ",", " ", "generator"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.694275982244867*^9, 3.6942760127346773`*^9}}],

Cell[BoxData[
 RowBox[{"ConnectionHandler", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\<\"Tag\"\>", "\[RuleDelayed]", 
     "MathematicaSimpleServer`ConnectionHandler`Private`tag$517"}], ",", 
    RowBox[{"\<\"RequestParser\"\>", "\[RuleDelayed]", 
     RowBox[{
     "RequestParser", "[", 
      "MathematicaSimpleServer`ConnectionHandler`Private`tag$517", "]"}]}], 
    ",", 
    RowBox[{"\<\"ServerBean\"\>", "\[RuleDelayed]", 
     RowBox[{
     "ServerBean", "[", 
      "MathematicaSimpleServer`ConnectionHandler`Private`tag$517", "]"}]}], 
    ",", 
    RowBox[{"\<\"ResponseGenerator\"\>", "\[RuleDelayed]", 
     RowBox[{
     "ResponseGenerator", "[", 
      "MathematicaSimpleServer`ConnectionHandler`Private`tag$517", "]"}]}]}], 
   "}"}], "]"}]], "Output",
 CellChangeTimes->{3.6942760154059687`*^9, 3.6942762260658703`*^9, 
  3.6942764555975847`*^9, 3.694276672974259*^9, 3.694276751469322*^9, 
  3.6942770736298523`*^9, 3.6942771443605175`*^9}]
}, Open  ]],

Cell["\:0418 \:043d\:0430\:043a\:043e\:043d\:0435\:0446 \:0441\:043e\:0437\
\:0434\:0430\:043d\:0438\:0435 \
\:0441\:0435\:0440\:0432\:0435\:0440\:0430!!!", "Text",
 CellChangeTimes->{{3.6942760204038444`*^9, 3.694276026293007*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"server", " ", "=", " ", 
  RowBox[{"MathematicaSimpleServerCreate", "[", 
   RowBox[{"8888", ",", " ", "handler"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.6942760290342245`*^9, 3.6942760447946844`*^9}}],

Cell[BoxData[
 RowBox[{"\<\"Server\"\>", "[", 
  TagBox[
   ButtonBox[
    PaneSelectorBox[{False->"\<\"http://localhost:8888/\"\>", True->
     StyleBox["\<\"http://localhost:8888/\"\>", "HyperlinkActive"]}, Dynamic[
      CurrentValue["MouseOver"]],
     BaseStyle->{"Hyperlink"},
     FrameMargins->0,
     ImageSize->Automatic],
    BaseStyle->"Hyperlink",
    ButtonData->{
      URL["http://localhost:8888/"], None},
    ButtonNote->"http://localhost:8888/"],
   Annotation[#, "http://localhost:8888/", "Hyperlink"]& ], "]"}]], "Output",
 CellChangeTimes->{3.694276046117955*^9, 3.6942762275203075`*^9, 
  3.694276674874357*^9, 3.6942767514983435`*^9, 3.6942770736598735`*^9, 
  3.6942771443875413`*^9}]
}, Open  ]],

Cell["\:0410 \:0432\:043e\:0442 \:0442\:0430\:043a \:0435\:0433\:043e \:043c\
\:043e\:0436\:043d\:043e \:043e\:0441\:0442\:0430\:043d\:043e\:0432\:0438\
\:0442\:044c", "Text",
 CellChangeTimes->{{3.694277313817544*^9, 3.6942773214047313`*^9}}],

Cell[BoxData[
 RowBox[{"MathematicaSimpleServerClose", "[", "server", "]"}]], "Code",
 CellChangeTimes->{{3.6942773287782907`*^9, 3.6942773378395967`*^9}}]
},
WindowSize->{775, 872},
WindowMargins->{{Automatic, 77}, {45, Automatic}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 195, 2, 30, "Text"],
Cell[756, 24, 135, 2, 50, "Code"],
Cell[894, 28, 338, 4, 30, "Text"],
Cell[1235, 34, 1867, 48, 214, "Code"],
Cell[3105, 84, 313, 4, 30, "Text"],
Cell[3421, 90, 1173, 26, 123, "Code"],
Cell[4597, 118, 353, 4, 30, "Text"],
Cell[4953, 124, 1052, 27, 502, "Code"],
Cell[6008, 153, 336, 4, 30, "Text"],
Cell[6347, 159, 607, 14, 123, "Code"],
Cell[6957, 175, 257, 3, 30, "Text"],
Cell[CellGroupData[{
Cell[7239, 182, 1312, 31, 447, "Code"],
Cell[8554, 215, 521, 11, 50, "Output"],
Cell[9078, 228, 417, 9, 30, "Output"],
Cell[9498, 239, 414, 9, 30, "Output"]
}, Open  ]],
Cell[9927, 251, 240, 3, 30, "Text"],
Cell[CellGroupData[{
Cell[10192, 258, 246, 5, 50, "Code"],
Cell[10441, 265, 964, 23, 107, "Output"]
}, Open  ]],
Cell[11420, 291, 232, 3, 30, "Text"],
Cell[CellGroupData[{
Cell[11677, 298, 227, 4, 50, "Code"],
Cell[11907, 304, 709, 17, 33, "Output"]
}, Open  ]],
Cell[12631, 324, 243, 3, 30, "Text"],
Cell[12877, 329, 155, 2, 50, "Code"]
}
]
*)

